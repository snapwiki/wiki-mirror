<div class="mw-parser-output"><div style="display: inline-flex !important; border: 2px solid #bee5eb; border-radius: 0px; background: #d1ecf1; text-align: center; color: #0c5460 !important; min-width: 50%; width: auto !important; justify-content: space-between"><div style="display: flex; align-items: center; justify-content: space-between; width: 100px; align-self: center;"><div><span style="font-size: 3em">⚙️</span></div></div><div style="width: 10%"></div><div><p><b>Advanced Content</b><br>This page contains advanced concepts and/or JavaScript.</p></div><div style="width: 100px;"></div></div><p>This page collects all tutorials for extending Snap's boundaries and documents preliminary steps in doing so.</p><h2><span class="mw-headline" id="Prelimnary">Prelimnary</span></h2><p>These tutorials suppose you have a basic knowledge of JavaScript and that <a rel="nofollow" class="external text" href="https://nodejs.org">NodeJS</a> is installed on your machine. You'll also need an editor. Your PC surely ships with a basic text editor (eg Notepad for Windows) but it surely doesn't support advanced features like an IDE can have. For this, I recommend <a rel="nofollow" class="external text" href="https://code.visualstudio.com">VSCode</a>. These tutorials will use it, but any other editor should work.</p><p>Check you have everything set up by opening a command shell (eg <code>cmd.exe</code> on Windows) and typing <code>node --version</code> and enter. You should see something like <code>v14.0.0</code>. Also try <code>npm --version</code>. I see <code>v6.14.9</code>, you should see something like that.</p><p>Create a new folder somewhere and open it in Visual Studio Code, in the "Terminal" window type <code>npm init -y</code> (and enter). Create a new file <code>index.js</code> and paste the following:</p><div class="mw-highlight mw-highlight-lang-js mw-content-ltr mw-highlight-lines" dir="ltr"><pre><span></span><span class="linenos" data-line="1"></span><span class="kd">const</span> <span class="nx">https</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'https'</span><span class="p">);</span> <span class="c1">// ①</span>
<span class="linenos" data-line="2"></span><span class="kd">const</span> <span class="p">{</span><span class="nx">readFileSync</span><span class="o">:</span> <span class="nx">rf</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span> <span class="c1">// ②</span>
<span class="linenos" data-line="3"></span>
<span class="linenos" data-line="4"></span><span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos" data-line="5"></span>  <span class="nx">key</span><span class="o">:</span> <span class="nx">rf</span><span class="p">(</span><span class="s1">'key.pem'</span><span class="p">),</span>
<span class="linenos" data-line="6"></span>  <span class="nx">cert</span><span class="o">:</span> <span class="nx">rf</span><span class="p">(</span><span class="s1">'cert.pem'</span><span class="p">)</span>
<span class="linenos" data-line="7"></span><span class="p">};</span> <span class="c1">// ③</span>
<span class="linenos" data-line="8"></span>
<span class="linenos" data-line="9"></span><span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">https</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span> <span class="c1">// ④</span>
<span class="linenos" data-line="10"></span>  <span class="nx">options</span><span class="p">,</span>
<span class="linenos" data-line="11"></span>  <span class="k">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="linenos" data-line="12"></span>    <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">'Access-Control-Allow-Origin'</span><span class="p">,</span> <span class="s1">'*'</span><span class="p">);</span>
<span class="linenos" data-line="13"></span>    <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">);</span>
<span class="linenos" data-line="14"></span>    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="sb">`Sample!`</span><span class="p">);</span>
<span class="linenos" data-line="15"></span>  <span class="p">}</span> <span class="c1">// ⑤</span>
<span class="linenos" data-line="16"></span><span class="p">);</span>
<span class="linenos" data-line="17"></span>
<span class="linenos" data-line="18"></span><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="o">+</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">||</span> <span class="mf">8080</span><span class="p">),</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Listening!'</span><span class="p">));</span> <span class="c1">// ⑥</span>
</pre></div><p>If you have worked in Node before, you can see we are reading two files <code>key.pem</code> and <code>cert.pem</code> that don't exist! This is because Snap<i>!</i> enforces HTTPS, that in short requires sites to have a "certificate" to prove they are not being hacked. As we are going to open a local server through which we communicate with Snap<i>!</i>, we are also needed to use HTTPS. For this, we will generate a <i>self-signed certificate</i>, that we must tell the browser to trust. Install <a rel="nofollow" class="external text" href="https://www.openssl.org">OpenSSL</a> and run these commands in the Terminal:</p><div class="mw-highlight mw-highlight-lang-sh mw-content-ltr" dir="ltr"><pre><span></span>openssl genrsa -out key.pem
openssl req -new -key key.pem -out csr.pem
openssl x509 -req -days <span class="m">9999</span> -in csr.pem -signkey key.pem -out cert.pem
rm csr.pem
</pre></div><p>Now run <code>node index</code> and when you see a line that says <code>Listening!</code>, open your favorite browser (the one you'll use with Snap<i>!</i>) and visit <code><a rel="nofollow" class="external free" href="https://localhost:8080">https://localhost:8080</a></code> (the <code>https://</code> part is important). You'll see a notice about the browser not trusting the certificate, but click on "Continue to site" or "Trust" or similar. If you don't see such a button, try clicking on Advanced Options. If you still can't find it, ask for help in the <a href="https://snapwiki.miraheze.org/wiki/Talk:Tutorials/Extending?action=edit&amp;redlink=1" class="new" title="Talk:Tutorials/Extending (page does not exist)">talk page</a>!</p><p>After these steps, you should see <code>Sample!</code> in your browser. If that's not the case, try double-checking your code, pressing Ctrl+C in your terminal to kill the Node process and restart it (<code>node index</code>).</p><p>Now try opening Snap<i>!</i>. Get the <code class="blocks">url [snap.berkeley.edu]&nbsp;:: sensing reporter</code> block and change it into <code class="blocks">url [https://localhost:8080]&nbsp;:: sensing reporter</code>. Click on it and this should be your result: <span class="mw-default-size" typeof="mw:File"><a href="https://snapwiki.miraheze.org/wiki/File:Extending-Preliminary-Sample!.png" class="mw-file-description"><img src="//static.miraheze.org/snapwikiwiki/9/99/Extending-Preliminary-Sample%21.png" decoding="async" loading="lazy" width="229" height="34" class="mw-file-element" data-file-width="229" data-file-height="34"></a></span>.</p><h3><span class="mw-headline" id="Modularization">Modularization</span></h3><p>Now it's time we add support for modularization. Edit the function inside <code>createServer</code> to be:</p><div class="mw-highlight mw-highlight-lang-js mw-content-ltr mw-highlight-lines" dir="ltr"><pre><span></span><span class="linenos" data-line="11"></span><span class="k">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="linenos" data-line="12"></span>  <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">'Access-Control-Allow-Origin'</span><span class="p">,</span> <span class="s1">'*'</span><span class="p">)</span>
<span class="linenos" data-line="13"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span> <span class="o">==</span> <span class="s1">'/'</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-line="14"></span>    <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">);</span>
<span class="linenos" data-line="15"></span>    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="sb">`~~ operational ~~`</span><span class="p">);</span>
<span class="linenos" data-line="16"></span>    <span class="k">return</span><span class="p">;</span>
<span class="linenos" data-line="17"></span>  <span class="p">}</span>
<span class="linenos" data-line="18"></span>  <span class="k">try</span> <span class="p">{</span>
<span class="linenos" data-line="19"></span>    <span class="kd">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\//</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="linenos" data-line="20"></span>    <span class="kd">const</span> <span class="nx">module</span> <span class="o">=</span> <span class="nx">v</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="linenos" data-line="21"></span>    <span class="kd">const</span> <span class="nx">command</span> <span class="o">=</span> <span class="nx">v</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span>
<span class="linenos" data-line="22"></span>    <span class="kd">const</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span>
<span class="linenos" data-line="23"></span>
<span class="linenos" data-line="24"></span>    <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">);</span>
<span class="linenos" data-line="25"></span>    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="k">await</span> <span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="sb">`./</span><span class="si">${</span><span class="nx">module</span><span class="si">}</span><span class="sb">`</span><span class="p">)[</span><span class="nx">command</span><span class="p">])(...</span><span class="nx">args</span><span class="p">));</span>
<span class="linenos" data-line="26"></span>  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos" data-line="27"></span>     <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">400</span><span class="p">);</span>
<span class="linenos" data-line="28"></span>     <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
<span class="linenos" data-line="29"></span>  <span class="p">}</span>
<span class="linenos" data-line="30"></span><span class="p">}</span>
</pre></div><p>Now we have support for modularization! Create another file <code>sample.js</code> and paste the following:</p><div class="mw-highlight mw-highlight-lang-js mw-content-ltr mw-highlight-lines" dir="ltr"><pre><span></span><span class="linenos" data-line="1"></span><span class="nx">exports</span><span class="p">.</span><span class="nx">main</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="linenos" data-line="2"></span>  <span class="k">return</span> <span class="s1">'Main sample!'</span>
<span class="linenos" data-line="3"></span><span class="p">}</span>
<span class="linenos" data-line="4"></span>
<span class="linenos" data-line="5"></span><span class="nx">exports</span><span class="p">.</span><span class="nx">operate</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">op</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="linenos" data-line="6"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">op</span> <span class="o">==</span> <span class="s1">'+'</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="o">+</span><span class="nx">a</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">+</span><span class="nx">b</span><span class="p">);</span>
<span class="linenos" data-line="7"></span>  <span class="k">return</span> <span class="kc">NaN</span><span class="p">;</span>
<span class="linenos" data-line="8"></span><span class="p">}</span>
</pre></div><p>Close and reopen the server (Ctrl-C, <code>node input</code>) and this time open <code><a rel="nofollow" class="external free" href="https://localhost:8080/sample/main">https://localhost:8080/sample/main</a></code>. You should see <code>Main sample!</code>. Now navigate to <code><a rel="nofollow" class="external free" href="https://localhost:8080/sample/operate/+/10/5">https://localhost:8080/sample/operate/+/10/5</a></code>. If you see <code>15</code>, then you're all set!</p><h2><span id="Next_steps_.28pre-build_modules.29"></span><span class="mw-headline" id="Next_steps_(pre-build_modules)">Next steps (pre-build modules)</span></h2><p>(TBA!)</p></div>