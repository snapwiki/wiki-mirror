<div class="mw-parser-output"><div style="display: inline-flex !important; border: 2px solid #bee5eb; border-radius: 0px; background: #d1ecf1; text-align: center; color: #0c5460 !important; min-width: 50%; width: auto !important; justify-content: space-between"><div style="display: flex; align-items: center; justify-content: space-between; width: 100px; align-self: center;"><div><span style="font-size: 3em">⚙️</span></div></div><div style="width: 10%"></div><div><p><b>Advanced Content</b><br>This page contains advanced concepts and/or JavaScript.</p></div><div style="width: 100px;"></div></div><p>This page collects all tutorials for extending Snap's boundaries and documents preliminary steps in doing so.</p><h2><span class="mw-headline" id="Prelimnary">Prelimnary</span></h2><p>These tutorials suppose you have a basic knowledge of JavaScript and that <a rel="nofollow" class="external text" href="https://nodejs.org">NodeJS</a> is installed on your machine. You'll also need an editor. Your PC surely ships with a basic text editor (eg Notepad for Windows) but it surely doesn't support advanced features like an IDE can have. For this, I recommend <a rel="nofollow" class="external text" href="https://code.visualstudio.com">VSCode</a>. These tutorials will use it, but any other editor should work.</p><p>Check you have everything set up by opening a command shell (eg <code>cmd.exe</code> on Windows) and typing <code>node --version</code> and enter. You should see something like <code>v14.0.0</code>. Also try <code>npm --version</code>. I see <code>v6.14.9</code>, you should see something like that.</p><p>Create a new folder somewhere and open it in Visual Studio Code, in the "Terminal" window type <code>npm init -y</code> (and enter). Create a new file <code>index.js</code> and paste the following:</p><p>&lt;syntaxhighlight lang=js line&gt; const https = require('https'); // ① const {readFileSync: rf} = require('fs'); // ②</p><p>const options = {</p><pre> key: rf('key.pem'),
 cert: rf('cert.pem')
</pre><p>}; // ③</p><p>const server = https.createServer( // ④</p><pre> options,
 async (req, res) =&gt; {
   res.setHeader('Access-Control-Allow-Origin', '*');
   res.writeHead(200);
   res.end(`Sample!`);
 } // ⑤
</pre><p>);</p><p>server.listen(+(process.argv[2] || 8080), () =&gt; console.log('Listening!')); // ⑥ &lt;/syntaxhighlight&gt;</p><p>If you have worked in Node before, you can see we are reading two files <code>key.pem</code> and <code>cert.pem</code> that don't exist! This is because Snap<i>!</i> enforces HTTPS, that in short requires sites to have a "certificate" to prove they are not being hacked. As we are going to open a local server through which we communicate with Snap<i>!</i>, we are also needed to use HTTPS. For this, we will generate a <i>self-signed certificate</i>, that we must tell the browser to trust. Install <a rel="nofollow" class="external text" href="https://www.openssl.org">OpenSSL</a> and run these commands in the Terminal:</p><p>&lt;syntaxhighlight lang=sh&gt; openssl genrsa -out key.pem openssl req -new -key key.pem -out csr.pem openssl x509 -req -days 9999 -in csr.pem -signkey key.pem -out cert.pem rm csr.pem &lt;/syntaxhighlight&gt;</p><p>Now run <code>node index</code> and when you see a line that says <code>Listening!</code>, open your favorite browser (the one you'll use with Snap<i>!</i>) and visit <code><a rel="nofollow" class="external free" href="https://localhost:8080">https://localhost:8080</a></code> (the <code>https://</code> part is important). You'll see a notice about the browser not trusting the certificate, but click on "Continue to site" or "Trust" or similar. If you don't see such a button, try clicking on Advanced Options. If you still can't find it, ask for help in the <a href="https://snapwiki.miraheze.org/wiki/Talk:Tutorials/Extending?action=edit&amp;redlink=1" class="new" title="Talk:Tutorials/Extending (page does not exist)">talk page</a>!</p><p>After these steps, you should see <code>Sample!</code> in your browser. If that's not the case, try double-checking your code, pressing Ctrl+C in your terminal to kill the Node process and restart it (<code>node index</code>).</p><p>Now try opening Snap<i>!</i>. Get the &lt;sb&gt;url [snap.berkeley.edu]&nbsp;:: sensing reporter&lt;/sb&gt; block and change it into &lt;sb&gt;url <a rel="nofollow" class="external autonumber" href="https://localhost:8080">[1]</a>&nbsp;:: sensing reporter&lt;/sb&gt;. Click on it and this should be your result: <span class="mw-default-size" typeof="mw:File"><a href="https://snapwiki.miraheze.org/wiki/File:Extending-Preliminary-Sample!.png" class="mw-file-description"><img src="//static.miraheze.org/snapwikiwiki/9/99/Extending-Preliminary-Sample%21.png" decoding="async" width="229" height="34" class="mw-file-element"></a></span>.</p><h3><span class="mw-headline" id="Modularization">Modularization</span></h3><p>Now it's time we add support for modularization. Edit the function inside <code>createServer</code> to be:</p><p>&lt;syntaxhighlight lang=js line start=11&gt; async (req, res) =&gt; {</p><pre> res.setHeader('Access-Control-Allow-Origin', '*')
 if (req.url == '/') {
   res.writeHead(200);
   res.end(`~~ operational ~~`);
   return;
 }
 try {
   const v = req.url.split(/\//).slice(1);
   const module = v[0];
   const command = v[1];
   const args = v.slice(2);
</pre><pre>   res.writeHead(200);
   res.end(await (require(`./${module}`)[command])(...args));
 } catch (e) {
    res.writeHead(400);
    res.end(e);
 }
</pre><p>} &lt;/syntaxhighlight&gt;</p><p>Now we have support for modularization! Create another file <code>sample.js</code> and paste the following:</p><p>&lt;syntaxhighlight lang=js line&gt; exports.main = async () =&gt; {</p><pre> return 'Main sample!'
</pre><p>}</p><p>exports.operate = async (op, a, b) =&gt; {</p><pre> if (op == '+') return (+a) + (+b);
 return NaN;
</pre><p>} &lt;/syntaxhighlight&gt;</p><p>Close and reopen the server (Ctrl-C, <code>node input</code>) and this time open <code><a rel="nofollow" class="external free" href="https://localhost:8080/sample/main">https://localhost:8080/sample/main</a></code>. You should see <code>Main sample!</code>. Now navigate to <code><a rel="nofollow" class="external free" href="https://localhost:8080/sample/operate/+/10/5">https://localhost:8080/sample/operate/+/10/5</a></code>. If you see <code>15</code>, then you're all set!</p><h2><span id="Next_steps_.28pre-build_modules.29"></span><span class="mw-headline" id="Next_steps_(pre-build_modules)">Next steps (pre-build modules)</span></h2><p>(TBA!)</p></div>